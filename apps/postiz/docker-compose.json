{
  "version": "3.8",
  "services": {
    "postiz": {
      "image": "ghcr.io/gitroomhq/postiz-app:latest",
      "container_name": "postiz",
      "restart": "unless-stopped",
      "environment": [
        "MAIN_URL=${MAIN_URL}",
        "FRONTEND_URL=${MAIN_URL}",
        "NEXT_PUBLIC_BACKEND_URL=${MAIN_URL}/api",
        "JWT_SECRET=${JWT_SECRET}",
        "DATABASE_URL=postgresql://postiz-user:postiz-password@postiz-postgres:5432/postiz-db-local",
        "REDIS_URL=redis://postiz-redis:6379",
        "BACKEND_INTERNAL_URL=http://localhost:3000",
        "IS_GENERAL=true",
        "DISABLE_REGISTRATION=${DISABLE_REGISTRATION:-false}",
        "NOT_SECURED=${NOT_SECURED:-false}",
        "STORAGE_PROVIDER=local",
        "UPLOAD_DIRECTORY=/uploads",
        "NEXT_PUBLIC_UPLOAD_DIRECTORY=/uploads"
      ],
      "volumes": [
        "${APP_DATA_DIR}/data/config:/config",
        "${APP_DATA_DIR}/data/uploads:/uploads"
      ],
      "ports": [
        "${APP_PORT}:5000"
      ],
      "networks": [
        "tipi_main_network"
      ],
      "depends_on": {
        "postiz-postgres": {
          "condition": "service_healthy"
        },
        "postiz-redis": {
          "condition": "service_healthy"
        }
      },
      "labels": {
        "tipi.enable": "true",
        "tipi.name": "postiz",
        "traefik.enable": "true",
        "traefik.http.routers.postiz.rule": "Host(`${APP_DOMAIN}`)",
        "traefik.http.routers.postiz.entrypoints": "websecure",
        "traefik.http.routers.postiz.service": "postiz",
        "traefik.http.services.postiz.loadbalancer.server.port": "5000",
        "traefik.http.routers.postiz.tls.certresolver": "myresolver"
      }
    },
    "postiz-postgres": {
      "image": "postgres:17-alpine",
      "container_name": "postiz-postgres",
      "restart": "unless-stopped",
      "environment": [
        "POSTGRES_PASSWORD=postiz-password",
        "POSTGRES_USER=postiz-user",
        "POSTGRES_DB=postiz-db-local"
      ],
      "volumes": [
        "${APP_DATA_DIR}/data/postgres:/var/lib/postgresql/data"
      ],
      "networks": [
        "tipi_main_network"
      ],
      "healthcheck": {
        "test": ["CMD-SHELL", "pg_isready -U postiz-user -d postiz-db-local"],
        "interval": "10s",
        "timeout": "3s",
        "retries": 3
      }
    },
    "postiz-redis": {
      "image": "redis:7.2",
      "container_name": "postiz-redis",
      "restart": "unless-stopped",
      "volumes": [
        "${APP_DATA_DIR}/data/redis:/data"
      ],
      "networks": [
        "tipi_main_network"
      ],
      "healthcheck": {
        "test": ["CMD", "redis-cli", "ping"],
        "interval": "10s",
        "timeout": "3s",
        "retries": 3
      }
    }
  },
  "networks": {
    "tipi_main_network": {
      "external": true
    }
  }
}